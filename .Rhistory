View(metabolomic_limma_t)
##########################
reaction_set_list <- list()
for(i in 1:10)
{}
##########################
reaction_set_list <- list()
for(i in 3:4)
{
print(i)
pen <- i/10
reaction_set_list[[i]] <- target_set_from_forest(tree_without_cofactors, metabolomic_limma_t$KEGG, penalty = pen)
}
for(i in 3:length(reaction_set_list))
{
reaction_set <- reaction_set_list[[i]]
reaction_set <- reaction_set %>% group_by(set,targets) %>% summarise_each(funs(sum(., na.rm = TRUE)))
reaction_set <- as.data.frame(reaction_set)
reaction_set[,2] <- gsub("_[a-z]$","",reaction_set[,2])
reaction_set <- reaction_set %>% group_by(set,targets) %>% summarise_each(funs(mean(., na.rm = TRUE)))
reaction_set <- as.data.frame(reaction_set)
reaction_set_list[[i]] <- reaction_set
}
##########################
penalty <- 3
n <- length(unique(reaction_set_list[[penalty]][,1]))
regulonNames = unique(reaction_set_list[[penalty]][,1])[1:n]
regulons_df <- reaction_set_list[[penalty]]
regulons_df <- regulons_df[regulons_df[,1] %in% unique(regulons_df[,1])[1:n],]
mean_NES_df <- metactivity(metabolomic_t_table = metabolomic_limma_t,
regulons_df = regulons_df,
compartment_pattern = "_[a-z]$",
k = 10000)
View(mean_NES_df)
pathways <- gmt_to_csv("~/Documents/GDC_KIRK/c2.cp.v7.0.symbols.gmt")
pathways <- pathways[grep("KEGG",pathways$term),]
BCCA <- pathways[pathways$term == "KEGG_VALINE_LEUCINE_AND_ISOLEUCINE_DEGRADATION","gene"]
mean_NES_df_to_subset <- mean_NES_df
mean_NES_df_to_subset$ID_short <- gsub(">.*","",mean_NES_df$KEGG)
mean_NES_df_to_subset$ID_short <- gsub("_.*","",mean_NES_df_to_subset$ID_short)
BCCA_activities <- mean_NES_df[mean_NES_df_to_subset$ID_short %in% BCCA,]
row.names(BCCA_activities) <- BCCA_activities$KEGG
BCCA_activities <- BCCA_activities[order(BCCA_activities$c786, decreasing = F),]
# BCCA_activities <- BCCA_activities[,c(1,2,3,5)]
BCCA_act_melt <- melt(BCCA_activities)
# BCCA_act_melt <- BCCA_act_melt[order(BCCA_act_melt$value, decreasing = F),]
BCCA_act_melt$KEGG <- factor(BCCA_act_melt$KEGG,levels = unique(BCCA_act_melt$KEGG))
names(BCCA_act_melt) <- c("Enzyme","Contrast","NES")
ggplot(BCCA_act_melt, aes(x=Contrast, y = Enzyme, fill = NES)) + geom_tile() +
scale_fill_gradient2(low="blue", high="red", midpoint = 0, mid = "white") +
theme_minimal() +
labs(y = "Enzyme", x = "Contrast")
save.image(file = "~/Dropbox/marco_metactivity/support/reaction_set_list_splitted_with_ASS1_no_cofac_marco_labelling_C13.RData")
reaction_network_kegg_to_name <- read_delim("Dropbox/marco_metactivity/support/reaction_network_kegg_to_name.txt",
"\t", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE)
reaction_network_kegg_to_name$X2 <- gsub(";.*","",reaction_network_kegg_to_name$X2)
reaction_network_kegg_to_name$X1 <- paste("cpd:",reaction_network_kegg_to_name$X1, sep = "")
reaction_network_kegg_to_name_vec <- reaction_network_kegg_to_name$X2
names(reaction_network_kegg_to_name_vec) <- reaction_network_kegg_to_name$X1
regulons_df_with_names <- regulons_df
for(i in 1:length(regulons_df[,1]))
{
regulons_df_with_names[i,2] <- reaction_network_kegg_to_name_vec[regulons_df_with_names[i,2]]
}
metabolomic_limma_t_names <- metabolomic_limma_t
metabolomic_limma_t_names$KEGG <- gsub("_.*","",metabolomic_limma_t_names$KEGG)
metabolomic_limma_t_names <- unique(metabolomic_limma_t_names)
metabolomic_limma_t_names <- metabolomic_limma_t_names[metabolomic_limma_t_names$KEGG %in% names(reaction_network_kegg_to_name_vec),]
for(i in 1:length(metabolomic_limma_t_names[,1]))
{
metabolomic_limma_t_names[i,1] <- reaction_network_kegg_to_name_vec[metabolomic_limma_t_names[i,1]]
}
source("~/Dropbox/marco_metactivity/scripts/metactivity_plot.R")
plotMetaboliteContribution("BCAT1",metabolomic_limma_t_names,regulons_df_with_names,1,
"t-value of 786O vs HK2")
View(mean_NES_df)
plotMetaboliteContribution("GOT1>909",metabolomic_limma_t_names,regulons_df_with_names,1,
"t-value of 786O vs HK2")
ggplot(BCCA_act_melt, aes(x=Contrast, y = Enzyme, fill = NES)) + geom_tile() +
scale_fill_gradient2(low="blue", high="red", midpoint = 0, mid = "white") +
theme_minimal() +
labs(y = "Enzyme", x = "Contrast")
plotMetaboliteContribution("BCAT1",metabolomic_limma_t_names,regulons_df_with_names,1,
"t-value of 786O vs HK2")
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
library(readxl)
library(vsn)
library(omicToolsTest)
library(limma)
library(readr)
library(dplyr)
library(reshape2)
library(pheatmap)
library(ggplot2)
source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
View(BCAT1I)
row.names(BCAT1I) <- paste0(BCAT1I$sample, 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.nameS(BCAT1I) <- tolower(row.nameS(BCAT1I))
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.names(BCAT1I) <- tolower(row.nameS(BCAT1I))
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.names(BCAT1I) <- tolower(row.names(BCAT1I))
targets <- as.data.frame(matrix(NA,length(BCAT1I[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- row.names(BCAT1I)
targets <- as.data.frame(matrix(NA,length(BCAT1I[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- names(BCAT1I)
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, "_", 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.names(BCAT1I) <- tolower(row.names(BCAT1I))
targets <- as.data.frame(matrix(NA,length(BCAT1I[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- names(BCAT1I)
targets$condition <- gsub("_.*","",targets$sample)
View(targets)
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, "_", 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.names(BCAT1I) <- tolower(row.names(BCAT1I))
targets <- as.data.frame(matrix(NA,length(BCAT1I[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- names(BCAT1I)
targets$condition <- gsub("_[0-9]{1}","",targets$sample)
batches <- BCAT1I
names(batches) <- targets$sample
row.names(batches) <- gsub(" ", "_", row.names(batches))
row.names(batches) <- tolower(row.names(batches))
batches <- as.data.frame(apply(batches,2,function(x){as.numeric(as.character(x))}))
batches <- log2(batches)
View(batches)
library(readxl)
library(vsn)
library(omicToolsTest)
library(limma)
library(readr)
library(dplyr)
library(reshape2)
library(pheatmap)
library(ggplot2)
source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, "_", 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.names(BCAT1I) <- tolower(row.names(BCAT1I))
targets <- as.data.frame(matrix(NA,length(BCAT1I[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- names(BCAT1I)
targets$condition <- gsub("_[0-9]{1}","",targets$sample)
batches <- BCAT1I
names(batches) <- targets$sample
row.names(batches) <- gsub(" ", "_", row.names(batches))
row.names(batches) <- tolower(row.names(batches))
batches[batches == 0] <- NA
batches <- log2(batches)
library(readxl)
library(vsn)
library(omicToolsTest)
library(limma)
library(readr)
library(dplyr)
library(reshape2)
library(pheatmap)
library(ggplot2)
source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, "_", 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.names(BCAT1I) <- tolower(row.names(BCAT1I))
targets <- as.data.frame(matrix(NA,length(BCAT1I[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- names(BCAT1I)
targets$condition <- gsub("_[0-9]{1}","",targets$sample)
batches <- BCAT1I
names(batches) <- targets$sample
row.names(batches) <- gsub(" ", "_", row.names(batches))
row.names(batches) <- tolower(row.names(batches))
batches[batches == 0] <- NA
# fit <- vsnMatrix(as.matrix(batches))
# meanSdPlot(fit)
# batches <- as.data.frame(vsn::predict(fit,as.matrix(batches)))
batches <- as.data.frame(log2(batches))
unique(targets$condition)
library(readxl)
library(vsn)
library(omicToolsTest)
library(limma)
library(readr)
library(dplyr)
library(reshape2)
library(pheatmap)
library(ggplot2)
source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, "_", 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
library(readxl)
library(vsn)
library(omicToolsTest)
library(limma)
library(readr)
library(dplyr)
library(reshape2)
library(pheatmap)
library(ggplot2)
source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, "_", 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.names(BCAT1I) <- tolower(row.names(BCAT1I))
targets <- as.data.frame(matrix(NA,length(BCAT1I[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- names(BCAT1I)
targets$condition <- gsub("_[0-9]{1,2}","",targets$sample)
batches <- BCAT1I
names(batches) <- targets$sample
row.names(batches) <- gsub(" ", "_", row.names(batches))
row.names(batches) <- tolower(row.names(batches))
batches[batches == 0] <- NA
# fit <- vsnMatrix(as.matrix(batches))
# meanSdPlot(fit)
# batches <- as.data.frame(vsn::predict(fit,as.matrix(batches)))
batches <- as.data.frame(log2(batches))
unique(targets$condition)
comparisons <- list("O_BCAT1IvO_DMSO" = c(4,-3),
"M1A_BCAT1IvM1A_DMSO" = c(6,-5),
"M2A_BCAT1IvM2A_DMSO" = c(8,-7),
"HK2_BCAT1IvHK2_DMOS" = c(2,-1))
limmaRes <- runLimma(batches, targets, comparisons = comparisons)
t_table <- ttop_list_to_t_table(
limma_res_to_ttop_list(limma_res = limmaRes,
comp_names = names(comparisons),
number = length(batches[,1]),
adjust.method = "fdr"))
View(t_table)
mapping_table <- as.data.frame(read_csv("Dropbox/marco_metactivity/support/plasmax_name_to_kegg.txt"))
t_table <- t_table_metactivity_input_formater(metabolomic_t_table = t_table,
mapping_table = mapping_table,
affixes = c("c","l","x","m","e","n","r"))
load("~/Dropbox/marco_metactivity/support/reaction_set_list_merged.Rdata")
penalty <- 6
n <- length(unique(reaction_set_list_merged[[penalty]][,1]))
regulonNames = unique(reaction_set_list_merged[[penalty]][,1])[1:n]
regulons_df <- reaction_set_list_merged[[penalty]]
regulons_df <- regulons_df[regulons_df[,1] %in% unique(regulons_df[,1])[1:n],]
mean_NES_df <- metactivity(metabolomic_t_table = t_table,
regulons_df = regulons_df,
compartment_pattern = "_[a-z]$",
k = 10000)
View(mean_NES_df)
reaction_network_kegg_to_name <- read_delim("Dropbox/marco_metactivity/support/reaction_network_kegg_to_name_combined.txt",
"\t", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE)
reaction_network_kegg_to_name$X2 <- gsub(";.*","",reaction_network_kegg_to_name$X2)
reaction_network_kegg_to_name$X1 <- paste("cpd:",reaction_network_kegg_to_name$X1, sep = "")
reaction_network_kegg_to_name_vec <- reaction_network_kegg_to_name$X2
names(reaction_network_kegg_to_name_vec) <- reaction_network_kegg_to_name$X1
regulons_df_with_names <- regulons_df
for(i in 1:length(regulons_df[,1]))
{
regulons_df_with_names[i,2] <- reaction_network_kegg_to_name_vec[regulons_df_with_names[i,2]]
}
metabolomic_t_table_names <- t_table
metabolomic_t_table_names$KEGG <- gsub("_.*","",metabolomic_t_table_names$KEGG)
metabolomic_t_table_names <- unique(metabolomic_t_table_names)
metabolomic_t_table_names <- metabolomic_t_table_names[metabolomic_t_table_names$KEGG %in% names(reaction_network_kegg_to_name_vec),]
for(i in 1:length(metabolomic_t_table_names[,1]))
{
metabolomic_t_table_names[i,1] <- reaction_network_kegg_to_name_vec[metabolomic_t_table_names[i,1]]
}
plotMetaboliteContribution("BCAT1>695",metabolomic_t_table_names,regulons_df_with_names,1,
"t-value of O_BCAT1 vs O_DMSO")
plotMetaboliteContribution("BCAT1>695",metabolomic_t_table_names,regulons_df_with_names,2,
"t-value of O_BCAT1 vs O_DMSO")
pathways <- gmt_to_csv("~/Documents/GDC_KIRK/c2.cp.v7.0.symbols.gmt")
pathways <- pathways[grep("KEGG",pathways$term),]
pathway_HM(mean_NES_df = mean_NES_df,
pathway_name = "KEGG_VALINE_LEUCINE_AND_ISOLEUCINE_DEGRADATION",
pathways = pathways)
mean_NES_df
mean_NES_df = mean_NES_df
pathway_name = "KEGG_VALINE_LEUCINE_AND_ISOLEUCINE_DEGRADATION"
pathways = pathways
current_pathway <- pathways[pathways$term == pathway_name,"gene"]
mean_NES_df_to_subset <- mean_NES_df
mean_NES_df_to_subset$ID_short <- gsub(">.*","",mean_NES_df$KEGG)
mean_NES_df_to_subset$ID_short <- gsub("_.*","",mean_NES_df_to_subset$ID_short)
current_pathway_activities <- mean_NES_df[mean_NES_df_to_subset$ID_short %in% current_pathway,]
row.names(current_pathway_activities) <- current_pathway_activities$KEGG
current_pathway_activities <- current_pathway_activities[order(current_pathway_activities$OvHK2, decreasing = F),]
current_pathway <- pathways[pathways$term == pathway_name,"gene"]
mean_NES_df = mean_NES_df
pathway_name = "KEGG_VALINE_LEUCINE_AND_ISOLEUCINE_DEGRADATION"
pathways = pathways
current_pathway <- pathways[pathways$term == pathway_name,"gene"]
View(pathways)
pathways$term == pathway_name
mean_NES_df_to_subset <- mean_NES_df
mean_NES_df_to_subset$ID_short <- gsub(">.*","",mean_NES_df$KEGG)
mean_NES_df_to_subset$ID_short <- gsub("_.*","",mean_NES_df_to_subset$ID_short)
current_pathway_activities <- mean_NES_df[mean_NES_df_to_subset$ID_short %in% current_pathway,]
View(current_pathway_activities)
row.names(current_pathway_activities) <- current_pathway_activities$KEGG
library(readxl)
library(vsn)
library(omicToolsTest)
library(limma)
library(readr)
library(dplyr)
library(reshape2)
library(pheatmap)
library(ggplot2)
source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, "_", 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.names(BCAT1I) <- tolower(row.names(BCAT1I))
targets <- as.data.frame(matrix(NA,length(BCAT1I[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- names(BCAT1I)
targets$condition <- gsub("_[0-9]{1,2}","",targets$sample)
batches <- BCAT1I
names(batches) <- targets$sample
row.names(batches) <- gsub(" ", "_", row.names(batches))
row.names(batches) <- tolower(row.names(batches))
batches[batches == 0] <- NA
# fit <- vsnMatrix(as.matrix(batches))
# meanSdPlot(fit)
# batches <- as.data.frame(vsn::predict(fit,as.matrix(batches)))
batches <- as.data.frame(log2(batches))
unique(targets$condition)
comparisons <- list("O_BCAT1IvO_DMSO" = c(4,-3),
"M1A_BCAT1IvM1A_DMSO" = c(6,-5),
"M2A_BCAT1IvM2A_DMSO" = c(8,-7),
"HK2_BCAT1IvHK2_DMOS" = c(2,-1))
limmaRes <- runLimma(batches, targets, comparisons = comparisons)
t_table <- ttop_list_to_t_table(
limma_res_to_ttop_list(limma_res = limmaRes,
comp_names = names(comparisons),
number = length(batches[,1]),
adjust.method = "fdr"))
mapping_table <- as.data.frame(read_csv("Dropbox/marco_metactivity/support/plasmax_name_to_kegg.txt"))
t_table <- t_table_metactivity_input_formater(metabolomic_t_table = t_table,
mapping_table = mapping_table,
affixes = c("c","l","x","m","e","n","r"))
load("~/Dropbox/marco_metactivity/support/reaction_set_list_merged.Rdata")
penalty <- 6
n <- length(unique(reaction_set_list_merged[[penalty]][,1]))
regulonNames = unique(reaction_set_list_merged[[penalty]][,1])[1:n]
regulons_df <- reaction_set_list_merged[[penalty]]
regulons_df <- regulons_df[regulons_df[,1] %in% unique(regulons_df[,1])[1:n],]
mean_NES_df <- metactivity(metabolomic_t_table = t_table,
regulons_df = regulons_df,
compartment_pattern = "_[a-z]$",
k = 10000)
reaction_network_kegg_to_name <- read_delim("Dropbox/marco_metactivity/support/reaction_network_kegg_to_name_combined.txt",
"\t", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE)
reaction_network_kegg_to_name$X2 <- gsub(";.*","",reaction_network_kegg_to_name$X2)
reaction_network_kegg_to_name$X1 <- paste("cpd:",reaction_network_kegg_to_name$X1, sep = "")
reaction_network_kegg_to_name_vec <- reaction_network_kegg_to_name$X2
names(reaction_network_kegg_to_name_vec) <- reaction_network_kegg_to_name$X1
regulons_df_with_names <- regulons_df
for(i in 1:length(regulons_df[,1]))
{
regulons_df_with_names[i,2] <- reaction_network_kegg_to_name_vec[regulons_df_with_names[i,2]]
}
metabolomic_t_table_names <- t_table
metabolomic_t_table_names$KEGG <- gsub("_.*","",metabolomic_t_table_names$KEGG)
metabolomic_t_table_names <- unique(metabolomic_t_table_names)
metabolomic_t_table_names <- metabolomic_t_table_names[metabolomic_t_table_names$KEGG %in% names(reaction_network_kegg_to_name_vec),]
for(i in 1:length(metabolomic_t_table_names[,1]))
{
metabolomic_t_table_names[i,1] <- reaction_network_kegg_to_name_vec[metabolomic_t_table_names[i,1]]
}
plotMetaboliteContribution("BCAT1>695",metabolomic_t_table_names,regulons_df_with_names,2,
"t-value of O_BCAT1 vs O_DMSO")
###########
pathways <- gmt_to_csv("~/Documents/GDC_KIRK/c2.cp.v7.0.symbols.gmt")
pathways <- pathways[grep("KEGG",pathways$term),]
pathway_HM(mean_NES_df = mean_NES_df,
pathway_name = "KEGG_VALINE_LEUCINE_AND_ISOLEUCINE_DEGRADATION",
pathways = pathways,
sort_by = 2)
source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
pathway_HM(mean_NES_df = mean_NES_df,
pathway_name = "KEGG_VALINE_LEUCINE_AND_ISOLEUCINE_DEGRADATION",
pathways = pathways,
sort_by = 2)
source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
pathway_HM(mean_NES_df = mean_NES_df,
pathway_name = "KEGG_VALINE_LEUCINE_AND_ISOLEUCINE_DEGRADATION",
pathways = pathways,
sort_by = 2)
plotMetaboliteContribution("BCAT1>695",metabolomic_t_table_names,regulons_df_with_names,2,
"t-value of O_BCAT1 vs O_DMSO")
setwd("~/Documents/transcriptutorial/")
knitr::opts_chunk$set(echo = TRUE)
#Main libraries
library(readr)
library(limma)
#Support functions also requires
library(ggplot2)
library(reshape)
library(pheatmap)
library(gridExtra)
library(grid)
library(cowplot)
library(ggrepel)
library(hexbin)
#Import the support funciton script
#/!\/!\ PATH MAY NEED TO BE ADAPTED /!\/!\
#/!\/!\ Don't forget to set working directory /!\/!\
source("scripts/support_functions.R")
count_df_vsn <- as.data.frame(read_csv("data/count_df_vsn.csv"))
targets <- as.data.frame(read_csv("support/targets.csv"))
#first check the conditions order
unique(targets$condition)
#we want to compare the KO with the WT so we build a comparison list
comparisons <- list("KOvsWT" = c(2,-1)) #each vector of the list represent the contrasts, here we substract the first condition (-1) to the second one (2)
#now that the comparisons are defined, we can run limma
limmaRes <- runLimma(measurements = count_df_vsn,
targets = targets,
comparisons = comparisons)
#once limma has run, we extract the statistic dataframe summarise the differential analysis
ttop_KOvsWT <- ttopFormatter(topTable(limmaRes[[1]], coef = 1, number = length(count_df_vsn[,1]), adjust.method = "fdr"))
##make a qqplot
null_model <- pnorm(rnorm(length(ttop_KOvsWT[,1])))
plot(sort(null_model), sort(ttop_KOvsWT$P.Value) ,xlim = c(1,0), ylim = c(1,0)) #not bad, not great, let's proceed
abline(coef = c(0,1))
View(ttop_KOvsWT)
knitr::opts_chunk$set(echo = TRUE)
#Main libraries
library(readr)
library(limma)
#Support functions also requires
library(ggplot2)
library(reshape)
library(pheatmap)
library(gridExtra)
library(grid)
library(cowplot)
library(ggrepel)
library(hexbin)
#Import the support funciton script
#/!\/!\ PATH MAY NEED TO BE ADAPTED /!\/!\
#/!\/!\ Don't forget to set working directory /!\/!\
source("scripts/support_functions.R")
#Data
count_df_vsn <- as.data.frame(read_csv("data/count_df_vsn.csv"))
#Design
targets <- as.data.frame(read_csv("support/targets.csv"))
#first check the conditions order
unique(targets$condition)
#we want to compare the KO with the WT so we build a comparison list
comparisons <- list("KOvsWT" = c(2,-1)) #each vector of the list represent the contrasts, here we substract the first condition (-1) to the second one (2)
#now that the comparisons are defined, we can run limma
limmaRes <- runLimma(measurements = count_df_vsn,
targets = targets,
comparisons = comparisons)
#once limma has run, we extract the statistic dataframe summarise the differential analysis
ttop_KOvsWT <- ttopFormatter(topTable(limmaRes[[1]], coef = 1, number = length(count_df_vsn[,1]), adjust.method = "fdr"))
View(count_df_vsn)
#Data
count_df_vsn <- as.data.frame(read_csv("data/count_df_vsn.csv"))
row.names(count_df_vsn) <- count_df_vsn[,1]
count_df_vsn <- count_df_vsn[,-1]
#Design
targets <- as.data.frame(read_csv("support/targets.csv"))
#first check the conditions order
unique(targets$condition)
#we want to compare the KO with the WT so we build a comparison list
comparisons <- list("KOvsWT" = c(2,-1)) #each vector of the list represent the contrasts, here we substract the first condition (-1) to the second one (2)
#now that the comparisons are defined, we can run limma
limmaRes <- runLimma(measurements = count_df_vsn,
targets = targets,
comparisons = comparisons)
#once limma has run, we extract the statistic dataframe summarise the differential analysis
ttop_KOvsWT <- ttopFormatter(topTable(limmaRes[[1]], coef = 1, number = length(count_df_vsn[,1]), adjust.method = "fdr"))
##make a qqplot
null_model <- pnorm(rnorm(length(ttop_KOvsWT[,1])))
plot(sort(null_model), sort(ttop_KOvsWT$P.Value) ,xlim = c(1,0), ylim = c(1,0)) #not bad, not great, let's proceed
abline(coef = c(0,1))
View(ttop_KOvsWT)
