new_kegg_mapping <- temp_kegg_mapping
new_kegg_mapping$KEGG <- paste(new_kegg_mapping$KEGG, aff, sep = "_")
kegg_mapping <- as.data.frame(rbind(kegg_mapping, new_kegg_mapping))
}
kegg_mapping <- kegg_mapping[-c(1:77),]
kegg_mapping[,1] <- tolower(kegg_mapping[,1])
metabolomic_limma_t$metabolite <- tolower(metabolomic_limma_t$metabolite)
metabolomic_limma_t <- merge(metabolomic_limma_t, kegg_mapping, by = "metabolite")
metabolomic_limma_t <- metabolomic_limma_t[,c(5,2,3,4)]
reaction_set_list <- list()
for(i in 1:10)
{
print(i)
pen <- i/10
reaction_set_list[[i]] <- target_set_from_forest(tree_without_cofactors, metabolomic_limma_t$KEGG, penalty = pen)
}
library(readxl)
library(dplyr)
library(omicToolsTest)
library(limma)
library(readr)
library(ggplot2)
library(pheatmap)
library(reshape2)
# source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
load("~/Dropbox/marco_metactivity/support/tree_no_ETC_splitted_with_ASS1_no_cofac.RData")
labelling <- as.data.frame(
read_excel("Dropbox/marco_metactivity/data/Labelling 13C Leucine and isoleucine plasmax.xlsx",
sheet = "Sheet2"))
# labelling <- labelling[,-1]
metabs <- names(labelling)[-1]
samples <- labelling$sample
batches <- as.data.frame(t(labelling[,-1]))
names(batches) <- samples
names(batches) <- paste(names(batches), c(1:length(batches)), sep = "_")
batches$metab <- row.names(batches)
batches$metab <- gsub("_m[+][0-9]","",batches$metab)
batches <- batches %>% group_by(metab) %>% summarise_each(funs(sum(., na.rm = TRUE)))
batches <- as.data.frame(batches)
row.names(batches) <- batches$metab
batches <- batches[,-1]
targets <- as.data.frame(matrix(NA,length(batches[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- names(batches)
targets$condition <- gsub("_.*","",names(batches))
non_zero_min <- sort(as.matrix(batches))[sort(as.matrix(batches)) != 0][1]
# batches[batches == 0] <- non_zero_min/2
batches[batches == 0] <- NA
batches <- log2(batches)
# magicPlotMaker(batches, "~/Documents/Marco/Marco/results/metabolomic/labelling/l1/log2",targets)
unique(targets$condition)
limmaRes <- runLimma(batches, targets, comparisons = list(c(2,-1),c(3,-1),c(3,-2)))
ttop_786 <- ttopFormatter(topTable(limmaRes[[1]], coef = 1, number = 46, adjust.method = "fdr"))
ttop_M1A <- ttopFormatter(topTable(limmaRes[[1]], coef = 2, number = 46, adjust.method = "fdr"))
ttop_M1Av786 <- ttopFormatter(topTable(limmaRes[[1]], coef = 3, number = 46, adjust.method = "fdr"))
t_table <- merge(ttop_786[,c(1,4)], ttop_M1A[,c(1,4)], by = "ID")
t_table <- merge(t_table, ttop_M1Av786[,c(1,4)], by = "ID")
names(t_table) <- c("ID","c786","M1A","M1Av786")
#########################
metabolomic_limma_t <- t_table
names(metabolomic_limma_t)[1] <- "metabolite"
kegg_mapping <- as.data.frame(read_delim("~/Documents/Marco/Marco/src/kegg_mapping",
"\t", escape_double = FALSE, trim_ws = TRUE))
names(kegg_mapping)[1] <- "metabolite"
kegg_mapping$KEGG <- paste("cpd:",kegg_mapping$KEGG, sep = "")
###WITH RECON
affixes <- c("c","l","x","m","e","n","r")
temp_kegg_mapping <- kegg_mapping
for (aff in affixes)
{
new_kegg_mapping <- temp_kegg_mapping
new_kegg_mapping$KEGG <- paste(new_kegg_mapping$KEGG, aff, sep = "_")
kegg_mapping <- as.data.frame(rbind(kegg_mapping, new_kegg_mapping))
}
View(kegg_mapping)
# kegg_mapping <- kegg_mapping[-c(1:77),]
kegg_mapping[,1] <- tolower(kegg_mapping[,1])
metabolomic_limma_t$metabolite <- tolower(metabolomic_limma_t$metabolite)
metabolomic_limma_t <- merge(metabolomic_limma_t, kegg_mapping, by = "metabolite")
metabolomic_limma_t <- metabolomic_limma_t[,c(5,2,3,4)]
View(metabolomic_limma_t)
##########################
reaction_set_list <- list()
for(i in 1:10)
{}
##########################
reaction_set_list <- list()
for(i in 3:4)
{
print(i)
pen <- i/10
reaction_set_list[[i]] <- target_set_from_forest(tree_without_cofactors, metabolomic_limma_t$KEGG, penalty = pen)
}
for(i in 3:length(reaction_set_list))
{
reaction_set <- reaction_set_list[[i]]
reaction_set <- reaction_set %>% group_by(set,targets) %>% summarise_each(funs(sum(., na.rm = TRUE)))
reaction_set <- as.data.frame(reaction_set)
reaction_set[,2] <- gsub("_[a-z]$","",reaction_set[,2])
reaction_set <- reaction_set %>% group_by(set,targets) %>% summarise_each(funs(mean(., na.rm = TRUE)))
reaction_set <- as.data.frame(reaction_set)
reaction_set_list[[i]] <- reaction_set
}
##########################
penalty <- 3
n <- length(unique(reaction_set_list[[penalty]][,1]))
regulonNames = unique(reaction_set_list[[penalty]][,1])[1:n]
regulons_df <- reaction_set_list[[penalty]]
regulons_df <- regulons_df[regulons_df[,1] %in% unique(regulons_df[,1])[1:n],]
mean_NES_df <- metactivity(metabolomic_t_table = metabolomic_limma_t,
regulons_df = regulons_df,
compartment_pattern = "_[a-z]$",
k = 10000)
View(mean_NES_df)
pathways <- gmt_to_csv("~/Documents/GDC_KIRK/c2.cp.v7.0.symbols.gmt")
pathways <- pathways[grep("KEGG",pathways$term),]
BCCA <- pathways[pathways$term == "KEGG_VALINE_LEUCINE_AND_ISOLEUCINE_DEGRADATION","gene"]
mean_NES_df_to_subset <- mean_NES_df
mean_NES_df_to_subset$ID_short <- gsub(">.*","",mean_NES_df$KEGG)
mean_NES_df_to_subset$ID_short <- gsub("_.*","",mean_NES_df_to_subset$ID_short)
BCCA_activities <- mean_NES_df[mean_NES_df_to_subset$ID_short %in% BCCA,]
row.names(BCCA_activities) <- BCCA_activities$KEGG
BCCA_activities <- BCCA_activities[order(BCCA_activities$c786, decreasing = F),]
# BCCA_activities <- BCCA_activities[,c(1,2,3,5)]
BCCA_act_melt <- melt(BCCA_activities)
# BCCA_act_melt <- BCCA_act_melt[order(BCCA_act_melt$value, decreasing = F),]
BCCA_act_melt$KEGG <- factor(BCCA_act_melt$KEGG,levels = unique(BCCA_act_melt$KEGG))
names(BCCA_act_melt) <- c("Enzyme","Contrast","NES")
ggplot(BCCA_act_melt, aes(x=Contrast, y = Enzyme, fill = NES)) + geom_tile() +
scale_fill_gradient2(low="blue", high="red", midpoint = 0, mid = "white") +
theme_minimal() +
labs(y = "Enzyme", x = "Contrast")
save.image(file = "~/Dropbox/marco_metactivity/support/reaction_set_list_splitted_with_ASS1_no_cofac_marco_labelling_C13.RData")
reaction_network_kegg_to_name <- read_delim("Dropbox/marco_metactivity/support/reaction_network_kegg_to_name.txt",
"\t", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE)
reaction_network_kegg_to_name$X2 <- gsub(";.*","",reaction_network_kegg_to_name$X2)
reaction_network_kegg_to_name$X1 <- paste("cpd:",reaction_network_kegg_to_name$X1, sep = "")
reaction_network_kegg_to_name_vec <- reaction_network_kegg_to_name$X2
names(reaction_network_kegg_to_name_vec) <- reaction_network_kegg_to_name$X1
regulons_df_with_names <- regulons_df
for(i in 1:length(regulons_df[,1]))
{
regulons_df_with_names[i,2] <- reaction_network_kegg_to_name_vec[regulons_df_with_names[i,2]]
}
metabolomic_limma_t_names <- metabolomic_limma_t
metabolomic_limma_t_names$KEGG <- gsub("_.*","",metabolomic_limma_t_names$KEGG)
metabolomic_limma_t_names <- unique(metabolomic_limma_t_names)
metabolomic_limma_t_names <- metabolomic_limma_t_names[metabolomic_limma_t_names$KEGG %in% names(reaction_network_kegg_to_name_vec),]
for(i in 1:length(metabolomic_limma_t_names[,1]))
{
metabolomic_limma_t_names[i,1] <- reaction_network_kegg_to_name_vec[metabolomic_limma_t_names[i,1]]
}
source("~/Dropbox/marco_metactivity/scripts/metactivity_plot.R")
plotMetaboliteContribution("BCAT1",metabolomic_limma_t_names,regulons_df_with_names,1,
"t-value of 786O vs HK2")
View(mean_NES_df)
plotMetaboliteContribution("GOT1>909",metabolomic_limma_t_names,regulons_df_with_names,1,
"t-value of 786O vs HK2")
ggplot(BCCA_act_melt, aes(x=Contrast, y = Enzyme, fill = NES)) + geom_tile() +
scale_fill_gradient2(low="blue", high="red", midpoint = 0, mid = "white") +
theme_minimal() +
labs(y = "Enzyme", x = "Contrast")
plotMetaboliteContribution("BCAT1",metabolomic_limma_t_names,regulons_df_with_names,1,
"t-value of 786O vs HK2")
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
library(readxl)
library(vsn)
library(omicToolsTest)
library(limma)
library(readr)
library(dplyr)
library(reshape2)
library(pheatmap)
library(ggplot2)
source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
View(BCAT1I)
row.names(BCAT1I) <- paste0(BCAT1I$sample, 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.nameS(BCAT1I) <- tolower(row.nameS(BCAT1I))
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.names(BCAT1I) <- tolower(row.nameS(BCAT1I))
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.names(BCAT1I) <- tolower(row.names(BCAT1I))
targets <- as.data.frame(matrix(NA,length(BCAT1I[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- row.names(BCAT1I)
targets <- as.data.frame(matrix(NA,length(BCAT1I[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- names(BCAT1I)
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, "_", 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.names(BCAT1I) <- tolower(row.names(BCAT1I))
targets <- as.data.frame(matrix(NA,length(BCAT1I[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- names(BCAT1I)
targets$condition <- gsub("_.*","",targets$sample)
View(targets)
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, "_", 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.names(BCAT1I) <- tolower(row.names(BCAT1I))
targets <- as.data.frame(matrix(NA,length(BCAT1I[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- names(BCAT1I)
targets$condition <- gsub("_[0-9]{1}","",targets$sample)
batches <- BCAT1I
names(batches) <- targets$sample
row.names(batches) <- gsub(" ", "_", row.names(batches))
row.names(batches) <- tolower(row.names(batches))
batches <- as.data.frame(apply(batches,2,function(x){as.numeric(as.character(x))}))
batches <- log2(batches)
View(batches)
library(readxl)
library(vsn)
library(omicToolsTest)
library(limma)
library(readr)
library(dplyr)
library(reshape2)
library(pheatmap)
library(ggplot2)
source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, "_", 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.names(BCAT1I) <- tolower(row.names(BCAT1I))
targets <- as.data.frame(matrix(NA,length(BCAT1I[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- names(BCAT1I)
targets$condition <- gsub("_[0-9]{1}","",targets$sample)
batches <- BCAT1I
names(batches) <- targets$sample
row.names(batches) <- gsub(" ", "_", row.names(batches))
row.names(batches) <- tolower(row.names(batches))
batches[batches == 0] <- NA
batches <- log2(batches)
library(readxl)
library(vsn)
library(omicToolsTest)
library(limma)
library(readr)
library(dplyr)
library(reshape2)
library(pheatmap)
library(ggplot2)
source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, "_", 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.names(BCAT1I) <- tolower(row.names(BCAT1I))
targets <- as.data.frame(matrix(NA,length(BCAT1I[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- names(BCAT1I)
targets$condition <- gsub("_[0-9]{1}","",targets$sample)
batches <- BCAT1I
names(batches) <- targets$sample
row.names(batches) <- gsub(" ", "_", row.names(batches))
row.names(batches) <- tolower(row.names(batches))
batches[batches == 0] <- NA
# fit <- vsnMatrix(as.matrix(batches))
# meanSdPlot(fit)
# batches <- as.data.frame(vsn::predict(fit,as.matrix(batches)))
batches <- as.data.frame(log2(batches))
unique(targets$condition)
library(readxl)
library(vsn)
library(omicToolsTest)
library(limma)
library(readr)
library(dplyr)
library(reshape2)
library(pheatmap)
library(ggplot2)
source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, "_", 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
library(readxl)
library(vsn)
library(omicToolsTest)
library(limma)
library(readr)
library(dplyr)
library(reshape2)
library(pheatmap)
library(ggplot2)
source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, "_", 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.names(BCAT1I) <- tolower(row.names(BCAT1I))
targets <- as.data.frame(matrix(NA,length(BCAT1I[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- names(BCAT1I)
targets$condition <- gsub("_[0-9]{1,2}","",targets$sample)
batches <- BCAT1I
names(batches) <- targets$sample
row.names(batches) <- gsub(" ", "_", row.names(batches))
row.names(batches) <- tolower(row.names(batches))
batches[batches == 0] <- NA
# fit <- vsnMatrix(as.matrix(batches))
# meanSdPlot(fit)
# batches <- as.data.frame(vsn::predict(fit,as.matrix(batches)))
batches <- as.data.frame(log2(batches))
unique(targets$condition)
comparisons <- list("O_BCAT1IvO_DMSO" = c(4,-3),
"M1A_BCAT1IvM1A_DMSO" = c(6,-5),
"M2A_BCAT1IvM2A_DMSO" = c(8,-7),
"HK2_BCAT1IvHK2_DMOS" = c(2,-1))
limmaRes <- runLimma(batches, targets, comparisons = comparisons)
t_table <- ttop_list_to_t_table(
limma_res_to_ttop_list(limma_res = limmaRes,
comp_names = names(comparisons),
number = length(batches[,1]),
adjust.method = "fdr"))
View(t_table)
mapping_table <- as.data.frame(read_csv("Dropbox/marco_metactivity/support/plasmax_name_to_kegg.txt"))
t_table <- t_table_metactivity_input_formater(metabolomic_t_table = t_table,
mapping_table = mapping_table,
affixes = c("c","l","x","m","e","n","r"))
load("~/Dropbox/marco_metactivity/support/reaction_set_list_merged.Rdata")
penalty <- 6
n <- length(unique(reaction_set_list_merged[[penalty]][,1]))
regulonNames = unique(reaction_set_list_merged[[penalty]][,1])[1:n]
regulons_df <- reaction_set_list_merged[[penalty]]
regulons_df <- regulons_df[regulons_df[,1] %in% unique(regulons_df[,1])[1:n],]
mean_NES_df <- metactivity(metabolomic_t_table = t_table,
regulons_df = regulons_df,
compartment_pattern = "_[a-z]$",
k = 10000)
View(mean_NES_df)
reaction_network_kegg_to_name <- read_delim("Dropbox/marco_metactivity/support/reaction_network_kegg_to_name_combined.txt",
"\t", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE)
reaction_network_kegg_to_name$X2 <- gsub(";.*","",reaction_network_kegg_to_name$X2)
reaction_network_kegg_to_name$X1 <- paste("cpd:",reaction_network_kegg_to_name$X1, sep = "")
reaction_network_kegg_to_name_vec <- reaction_network_kegg_to_name$X2
names(reaction_network_kegg_to_name_vec) <- reaction_network_kegg_to_name$X1
regulons_df_with_names <- regulons_df
for(i in 1:length(regulons_df[,1]))
{
regulons_df_with_names[i,2] <- reaction_network_kegg_to_name_vec[regulons_df_with_names[i,2]]
}
metabolomic_t_table_names <- t_table
metabolomic_t_table_names$KEGG <- gsub("_.*","",metabolomic_t_table_names$KEGG)
metabolomic_t_table_names <- unique(metabolomic_t_table_names)
metabolomic_t_table_names <- metabolomic_t_table_names[metabolomic_t_table_names$KEGG %in% names(reaction_network_kegg_to_name_vec),]
for(i in 1:length(metabolomic_t_table_names[,1]))
{
metabolomic_t_table_names[i,1] <- reaction_network_kegg_to_name_vec[metabolomic_t_table_names[i,1]]
}
plotMetaboliteContribution("BCAT1>695",metabolomic_t_table_names,regulons_df_with_names,1,
"t-value of O_BCAT1 vs O_DMSO")
plotMetaboliteContribution("BCAT1>695",metabolomic_t_table_names,regulons_df_with_names,2,
"t-value of O_BCAT1 vs O_DMSO")
pathways <- gmt_to_csv("~/Documents/GDC_KIRK/c2.cp.v7.0.symbols.gmt")
pathways <- pathways[grep("KEGG",pathways$term),]
pathway_HM(mean_NES_df = mean_NES_df,
pathway_name = "KEGG_VALINE_LEUCINE_AND_ISOLEUCINE_DEGRADATION",
pathways = pathways)
mean_NES_df
mean_NES_df = mean_NES_df
pathway_name = "KEGG_VALINE_LEUCINE_AND_ISOLEUCINE_DEGRADATION"
pathways = pathways
current_pathway <- pathways[pathways$term == pathway_name,"gene"]
mean_NES_df_to_subset <- mean_NES_df
mean_NES_df_to_subset$ID_short <- gsub(">.*","",mean_NES_df$KEGG)
mean_NES_df_to_subset$ID_short <- gsub("_.*","",mean_NES_df_to_subset$ID_short)
current_pathway_activities <- mean_NES_df[mean_NES_df_to_subset$ID_short %in% current_pathway,]
row.names(current_pathway_activities) <- current_pathway_activities$KEGG
current_pathway_activities <- current_pathway_activities[order(current_pathway_activities$OvHK2, decreasing = F),]
current_pathway <- pathways[pathways$term == pathway_name,"gene"]
mean_NES_df = mean_NES_df
pathway_name = "KEGG_VALINE_LEUCINE_AND_ISOLEUCINE_DEGRADATION"
pathways = pathways
current_pathway <- pathways[pathways$term == pathway_name,"gene"]
View(pathways)
pathways$term == pathway_name
mean_NES_df_to_subset <- mean_NES_df
mean_NES_df_to_subset$ID_short <- gsub(">.*","",mean_NES_df$KEGG)
mean_NES_df_to_subset$ID_short <- gsub("_.*","",mean_NES_df_to_subset$ID_short)
current_pathway_activities <- mean_NES_df[mean_NES_df_to_subset$ID_short %in% current_pathway,]
View(current_pathway_activities)
row.names(current_pathway_activities) <- current_pathway_activities$KEGG
library(readxl)
library(vsn)
library(omicToolsTest)
library(limma)
library(readr)
library(dplyr)
library(reshape2)
library(pheatmap)
library(ggplot2)
source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
BCAT1I <- as.data.frame(read_excel("Dropbox/marco_metactivity/data/Metabolomics with BCATI plasmax.xlsx",
sheet = "Sheet2"))
row.names(BCAT1I) <- paste0(BCAT1I$sample, "_", 1:length(BCAT1I[,1]))
BCAT1I <- BCAT1I[,-1]
BCAT1I <- as.data.frame(t(BCAT1I))
row.names(BCAT1I) <- tolower(row.names(BCAT1I))
targets <- as.data.frame(matrix(NA,length(BCAT1I[1,]),2))
names(targets) <- c("sample","condition")
targets$sample <- names(BCAT1I)
targets$condition <- gsub("_[0-9]{1,2}","",targets$sample)
batches <- BCAT1I
names(batches) <- targets$sample
row.names(batches) <- gsub(" ", "_", row.names(batches))
row.names(batches) <- tolower(row.names(batches))
batches[batches == 0] <- NA
# fit <- vsnMatrix(as.matrix(batches))
# meanSdPlot(fit)
# batches <- as.data.frame(vsn::predict(fit,as.matrix(batches)))
batches <- as.data.frame(log2(batches))
unique(targets$condition)
comparisons <- list("O_BCAT1IvO_DMSO" = c(4,-3),
"M1A_BCAT1IvM1A_DMSO" = c(6,-5),
"M2A_BCAT1IvM2A_DMSO" = c(8,-7),
"HK2_BCAT1IvHK2_DMOS" = c(2,-1))
limmaRes <- runLimma(batches, targets, comparisons = comparisons)
t_table <- ttop_list_to_t_table(
limma_res_to_ttop_list(limma_res = limmaRes,
comp_names = names(comparisons),
number = length(batches[,1]),
adjust.method = "fdr"))
mapping_table <- as.data.frame(read_csv("Dropbox/marco_metactivity/support/plasmax_name_to_kegg.txt"))
t_table <- t_table_metactivity_input_formater(metabolomic_t_table = t_table,
mapping_table = mapping_table,
affixes = c("c","l","x","m","e","n","r"))
load("~/Dropbox/marco_metactivity/support/reaction_set_list_merged.Rdata")
penalty <- 6
n <- length(unique(reaction_set_list_merged[[penalty]][,1]))
regulonNames = unique(reaction_set_list_merged[[penalty]][,1])[1:n]
regulons_df <- reaction_set_list_merged[[penalty]]
regulons_df <- regulons_df[regulons_df[,1] %in% unique(regulons_df[,1])[1:n],]
mean_NES_df <- metactivity(metabolomic_t_table = t_table,
regulons_df = regulons_df,
compartment_pattern = "_[a-z]$",
k = 10000)
reaction_network_kegg_to_name <- read_delim("Dropbox/marco_metactivity/support/reaction_network_kegg_to_name_combined.txt",
"\t", escape_double = FALSE, col_names = FALSE,
trim_ws = TRUE)
reaction_network_kegg_to_name$X2 <- gsub(";.*","",reaction_network_kegg_to_name$X2)
reaction_network_kegg_to_name$X1 <- paste("cpd:",reaction_network_kegg_to_name$X1, sep = "")
reaction_network_kegg_to_name_vec <- reaction_network_kegg_to_name$X2
names(reaction_network_kegg_to_name_vec) <- reaction_network_kegg_to_name$X1
regulons_df_with_names <- regulons_df
for(i in 1:length(regulons_df[,1]))
{
regulons_df_with_names[i,2] <- reaction_network_kegg_to_name_vec[regulons_df_with_names[i,2]]
}
metabolomic_t_table_names <- t_table
metabolomic_t_table_names$KEGG <- gsub("_.*","",metabolomic_t_table_names$KEGG)
metabolomic_t_table_names <- unique(metabolomic_t_table_names)
metabolomic_t_table_names <- metabolomic_t_table_names[metabolomic_t_table_names$KEGG %in% names(reaction_network_kegg_to_name_vec),]
for(i in 1:length(metabolomic_t_table_names[,1]))
{
metabolomic_t_table_names[i,1] <- reaction_network_kegg_to_name_vec[metabolomic_t_table_names[i,1]]
}
plotMetaboliteContribution("BCAT1>695",metabolomic_t_table_names,regulons_df_with_names,2,
"t-value of O_BCAT1 vs O_DMSO")
###########
pathways <- gmt_to_csv("~/Documents/GDC_KIRK/c2.cp.v7.0.symbols.gmt")
pathways <- pathways[grep("KEGG",pathways$term),]
pathway_HM(mean_NES_df = mean_NES_df,
pathway_name = "KEGG_VALINE_LEUCINE_AND_ISOLEUCINE_DEGRADATION",
pathways = pathways,
sort_by = 2)
source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
pathway_HM(mean_NES_df = mean_NES_df,
pathway_name = "KEGG_VALINE_LEUCINE_AND_ISOLEUCINE_DEGRADATION",
pathways = pathways,
sort_by = 2)
source("~/Dropbox/marco_metactivity/scripts/metactivity_function.R")
pathway_HM(mean_NES_df = mean_NES_df,
pathway_name = "KEGG_VALINE_LEUCINE_AND_ISOLEUCINE_DEGRADATION",
pathways = pathways,
sort_by = 2)
plotMetaboliteContribution("BCAT1>695",metabolomic_t_table_names,regulons_df_with_names,2,
"t-value of O_BCAT1 vs O_DMSO")
setwd("~/Documents/transcriptutorial")
knitr::opts_chunk$set(echo = TRUE)
source("scripts/support_functions.R")
getwd()
getwd()
#Import the support funciton script
#/!\/!\ PATH NEEDS TO BE ADAPTED /!\/!\
setwd("/Users/Aurelien/Documents/transcriptutorial")
